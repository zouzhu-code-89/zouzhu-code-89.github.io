<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VitePress</title>
    <meta name="description" content="bolg ...">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.BXh5mHKH.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.yaEZZV4Z.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.Gmd0D3gy.js">
    <link rel="modulepreload" href="/assets/chunks/theme.Dg-Jwvn7.js">
    <link rel="modulepreload" href="/assets/chunks/katex.CfZphoad.js">
    <link rel="modulepreload" href="/assets/chunks/dagre-4EVJKHTY.qBuP09Gl.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-6F5ED5ID.iQvEtyuB.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-7ASYPVHJ.C_vPCfpf.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-6RL3IURR.BwahsMoM.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-NRZ2UAAF.DKdLKev6.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-NTVNEXSI.o0DeQDvC.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-A4XQUW5V.jydJEhpX.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-YF2LJOPJ.B1Y5_50S.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-OS5C2QUG.Duk7wZEV.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-6QU3TZC5.B09A2HRx.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-MIRIMTAZ.BJvXQDPi.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-G6AWOVSC.BcCbf-bn.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-LNE6IOMH.Mku1OjMZ.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-MQ7JQ4JX.Mku1OjMZ.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-MAYHULR4.O-pIwMBA.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-4JROLMXI.CVrHnCps.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-G5WM74LC.Cs1KaLWE.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-U7ZMHBDA.qZ074ZHV.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-GWI6TPTV.CX9Mx0yn.js">
    <link rel="modulepreload" href="/assets/chunks/kanban-definition-QRCXZQQD.ClerBta3.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-Y46BX6SQ.54u3Zt8p.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-QW4FP2JN.BxaU7NOQ.js">
    <link rel="modulepreload" href="/assets/chunks/blockDiagram-ZHA2E4KO.Bk5v58jU.js">
    <link rel="modulepreload" href="/assets/chunks/architectureDiagram-UYN6MBPD.CxVduelB.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/assets/document_services_ruby_rails_Rails Controller 控制器.md.CeSCm7kl.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div><div class="w-screen h-[0px]"><!----></div><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/" data-v-9f43907a><!--[--><!--]--><!----><span data-v-9f43907a>Zouzhu's Wiki</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="mailto:zouzhuqorg@gmail.com" target="_blank" rel="noreferrer" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>联系我</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zouzhu-code-89" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="..." aria-label="twitter" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-twitter"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zouzhu-code-89" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="..." aria-label="twitter" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-twitter"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>目录大纲</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _document_services_ruby_rails_Rails%20Controller%20%E6%8E%A7%E5%88%B6%E5%99%A8" data-v-e6f2a212><div><h2 id="controller-创建控制器" tabindex="-1">Controller 创建控制器 <a class="header-anchor" href="#controller-创建控制器" aria-label="Permalink to &quot;Controller 创建控制器&quot;">​</a></h2><p>Rails Controller 业务逻辑控制层是严格遵守类的继承关系的，在 Rails 项目里面所有的 controller 都是默认情况下都是继承 ApplicationController 这个类，而 ApplicationController 则是继承 ActionController::Base 这个基类去拓展的。</p><p>在项目配置章节，我们讲到了可以使用 Rails generate controller Welcome index 这个命令一站式帮我们创建好控制层controller，视图层view，模型层mode等一些列文件。同时也可以自己手动创建好这些文件，只要符合 Rails 的约定约束规范就好了，比如我们创建一个用户注册的 users 页面步骤依次是 ：</p><ul><li>app/controller → users_controller.rb 首先创建 controller</li></ul><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UsersController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 新用户注册页面</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><ul><li>app/view/users/new.html.erb 然后创建 users 目录对应着 user_controller ，然后创建 new.htm.erb 对应着 UserController → def new 这个页面的方法</li><li>config/routes.rb 添加路由指向 users</li></ul><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Rails</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">application</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">routes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">draw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> do</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # root 是指向着首页位置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # welcome_controller.rb -&gt; def index 方法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  root </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;welcome#index&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 使用 resource 添加 users 这个控制层</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resource </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:users</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><ul><li>浏览器地址栏访问 <a href="http://127.0.0.1:4001/users/new.html" target="_blank" rel="noreferrer">http://127.0.0.1:4001/users/new.html</a> 就可以看到 new.html.erb 下面的内容了</li></ul><h2 id="filter-过滤器" tabindex="-1">Filter 过滤器 <a class="header-anchor" href="#filter-过滤器" aria-label="Permalink to &quot;Filter 过滤器&quot;">​</a></h2><p>过滤器是在控制器操作之前或之后或周期运行的方法，过滤器是继承的，因此如果你在 ApplicationController 控制器上设置过滤器，它将在应用程序上的每个控制器上运行，Filter 应用场景用于用户登陆校验，用户请求追踪等等 ...</p><h3 id="常见的过滤器" tabindex="-1">常见的过滤器 <a class="header-anchor" href="#常见的过滤器" aria-label="Permalink to &quot;常见的过滤器&quot;">​</a></h3><p>常见的 Fitter 有 before_action、around_action、after_action</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ActionController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Base</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 这样在访问继承 ApplicationController 的控制器之前，都会先确认 auth_user 用户是否有登陆</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# - 同时也可以定义 only 就是仅仅是 index 这个方法才会提前触发 auth_user 这个方法.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# - 同时我们也可以使用反向操作 except: [:index] 就是默认全部方法都要提前触发 auth_user 这个方法，而 index 这个方法除外</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	before_action </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:auth_user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">only:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	private</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> auth_user</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		unless</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> session[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			flash[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:notice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;请登录&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			redirect_to new_session_path</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><p>特殊说明，around_action 这个阶段在中间执行，并且需要 yield 执行块里的函数 sign，否则程序会卡住</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UsersController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	before_action </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:func_before_action</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	around_action </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:func_around_action</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	after_action  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:func_after_action</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sign</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		puts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;sign --------&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> func_before_action</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		puts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;before_action&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> func_around_action</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		puts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;around_action_before&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		yield</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		puts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;around_action_after&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> func_after_action</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		puts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;after_action&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可以看到下面的输出就知道 around_action 的执行顺序了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># before -&gt; around -&gt; def action -&gt; after -&gt; around</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-----------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Started</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/users/sign&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 127.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> at </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2021</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">05</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 06</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">14</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">49</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0800</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Processing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> by </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UsersController</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#sign as HTML</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">before_action</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">around_action_before</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sign </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--------</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  Rendering</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sign.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">erb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> within layouts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">application</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  Rendered</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sign.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">erb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> within layouts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">application (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">4ms)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">after_action</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">around_action_after</span></span></code></pre></div><h3 id="跳过控制器" tabindex="-1">跳过控制器 <a class="header-anchor" href="#跳过控制器" aria-label="Permalink to &quot;跳过控制器&quot;">​</a></h3><p>LoginsController 继承 ApplicationController 控制器，所以也会提前执行登陆校验然后跳转到登陆页，然而它本身就是登陆业务的控制器，所以会出现用户一开始就无法登录，不行的刷新死循环，所以此时我们可以在不使用登陆校验的同时直接跳过它，使用 skip_before_action 即可...</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> LoginsController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  skip_before_action </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:auth_user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">only:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># skip_before_action、skip_around_action、skip_after_action</span></span></code></pre></div><h3 id="helper-method" tabindex="-1">helper_method <a class="header-anchor" href="#helper-method" aria-label="Permalink to &quot;helper_method&quot;">​</a></h3><p>这个属性的作用就是定义公共的方法，比如我们现在定义了 current_user 这个方法，然后注册 helper_method 这个属性，我们就可以在 UsersController 里或者继承它的控制器中使用 current_user 这个方法 。</p><p>我们知道 view 层 (.html.erb) 中提供的内置方法数量是有限的，如果我们想使用我们自己定义的方法，就可以将方法注册 helper_method 属性就可以使用了 。</p><div class="language-jsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UsersController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	helper_method</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">current_user</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	protected</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> current_user</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			user</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		else</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			nil</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		end</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	end</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span></span></code></pre></div><h2 id="action-中使用-render" tabindex="-1">Action 中使用 Render <a class="header-anchor" href="#action-中使用-render" aria-label="Permalink to &quot;Action 中使用 Render&quot;">​</a></h2><p>Rails 默认帮我们渲染 render html 模板，并不需要我们声明 render，但是我们也可以主动 render 需要渲染返回给客户端的数据格式，常见的数据渲染格式如下代码所示 ：</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> search</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	#...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">text:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ok&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @users </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">xml:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @users</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">file:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;app/views/users/index&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">partial:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;app/views/users/search&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">status:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 500</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">status:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :forbidden</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">layout:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;application&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">layout:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h3 id="xml-json-text-status-数据" tabindex="-1">Xml，Json，Text，Status 数据 <a class="header-anchor" href="#xml-json-text-status-数据" aria-label="Permalink to &quot;Xml，Json，Text，Status 数据&quot;">​</a></h3><p>controller action 中可以 render 渲染输出很多种类型的数据，最常见的就是默认直接渲染模板 xxx.html.erb 文件，不需要我们生命 render 方法，其实它也可以返回 XML，JSON 数据</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UsersController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 可能会在上面的代码中注意到我们使用的是 render xml: @users，而不是render xml: @users.to_xml</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 如果对象不是 String，那么 Rails 会自动 to_xml 为我们调用</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> index</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">all</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    respond_to </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |format|</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">html</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # index.html.erb</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xml</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">xml:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @users }</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @users }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 下面这种形式也可以，上面是 Rails 定义的例子，下面这行是我自己补充的</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sign</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">			status:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">			msg:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">				text:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;sign success&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> render_text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">text:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ok&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> render_status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">status:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# rails 提供了状态码常量都可以</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">status:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :ok</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>http status code in Rails</span></span>
<span class="line"><span>-------------------------------------------</span></span>
<span class="line"><span>100     -&gt;       :continue</span></span>
<span class="line"><span>200     -&gt;       :ok</span></span>
<span class="line"><span>300     -&gt;       :multiple_choices</span></span>
<span class="line"><span>301     -&gt;       :moved_permanently</span></span>
<span class="line"><span>304     -&gt;       :not_modified</span></span>
<span class="line"><span>400     -&gt;       :bad_request</span></span>
<span class="line"><span>401     -&gt;       :unauthorized</span></span>
<span class="line"><span>403     -&gt;       :forbidden</span></span>
<span class="line"><span>404     -&gt;       :not_found</span></span>
<span class="line"><span>500     -&gt;       :internal_server_error</span></span>
<span class="line"><span>502     -&gt;       :bad_gateway</span></span></code></pre></div><h3 id="action-使用指定模板" tabindex="-1">Action 使用指定模板 <a class="header-anchor" href="#action-使用指定模板" aria-label="Permalink to &quot;Action 使用指定模板&quot;">​</a></h3><p>例如我们现在有这样一个需求，/Users/index 相当于一个数据列表页面，而 search 相当于一个搜索后的结果页面，除了数据的条目数不一样其他样式都一样，这个时候我们就没必要重新建立一个 search.html.erb 视图页面，反正都是循环 @user 数据，这个时候我们可以 render action 就可以将模板文件指定到 index.html.erb 了，总结就是自由指定使用哪个模板文件渲染 。</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UsersController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> index</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		@user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(....)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> search</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		@users</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(....)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">action:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :index</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h3 id="layout-公共模板" tabindex="-1">Layout 公共模板 <a class="header-anchor" href="#layout-公共模板" aria-label="Permalink to &quot;Layout 公共模板&quot;">​</a></h3><p>UsersController 这个控制器声明了所有 action layout 默认使用 application 这个模板，如果我们想使用另一个模板可以像 index action，如果我们不想使用模板可以像 def sign 声明为 false 即可.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UsersController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	layout </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> index</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">layout:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;header_application&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sign</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">layout:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h3 id="使用的注意事项" tabindex="-1">使用的注意事项 <a class="header-anchor" href="#使用的注意事项" aria-label="Permalink to &quot;使用的注意事项&quot;">​</a></h3><p>我们不应该重复 render，否则项目会报错，如下代码所示-根据 if 条件执行不同的 render 时，一定要 return 跳出后面的代码，避免继续执行 。</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> index</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	@users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">status:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @users.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ok&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		return</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;not&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h3 id="redirect-to-请求重定向" tabindex="-1">redirect_to 请求重定向 <a class="header-anchor" href="#redirect-to-请求重定向" aria-label="Permalink to &quot;redirect_to 请求重定向&quot;">​</a></h3><p>redirect_to(option = {}, response_options_and_flash = {})</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> show</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		redirect_to learn_blogs_path, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">status:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 301</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # permanment  访问一次就没有了这个路径了</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		redirect_to learn_blogs_path, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">status:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 302</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # temporary   临时的，以后还是可以访问</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h3 id="layout-采用模板" tabindex="-1">layout 采用模板 <a class="header-anchor" href="#layout-采用模板" aria-label="Permalink to &quot;layout 采用模板&quot;">​</a></h3><p>layout 为 Rails 模板，比如我们可以将 Header，Footer 定义为 layout 模板使用</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Admin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UsersController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 全局 controller 使用 admin layout 模板</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	layout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:admin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> index</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# ...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> new</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		#... 我们也可以在方法中指定特定的 layout</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">layout:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;application&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> edit</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		#... 我们也可以返回 false 不使用 layout</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">layout:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># admin.html.erb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;....&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		&lt;!-- 这个地方就是输出的占位了 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">		&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">%= yield %&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">footer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;....&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">footer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>layout 还可以指定一个运行时的逻辑，但是 lay 参数的数据类型，这里必须是 Symbol （:option 这种前缀是分号的就是 Symbol 类型 ），下面案例就是根据不同的 Symbol 切换不同的模板使用 。</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Admin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UsersController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	layout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:generate_layout</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> index</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @current_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> new</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		#...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		@current_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :admin</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	private</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate_layout</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		@current_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :normal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;application&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;admin&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><p>layout 同时也会采用继承关系，当子类没有声明 layout 的时候，就会默认使用父类的 layout</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Admin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BaseController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	layout </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;admin&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Admin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BlogsController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Admin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BaseController</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# layout will use be &#39;admin&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Admin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UsersController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Admin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BaseController</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	layout:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;user&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h2 id="rescue-rails-错误处理" tabindex="-1">Rescue Rails 错误处理 <a class="header-anchor" href="#rescue-rails-错误处理" aria-label="Permalink to &quot;Rescue Rails 错误处理&quot;">​</a></h2><p>您的应用程序很可能包含 bug 或抛出需要处理的异常，例如用户跟踪到数据库中不存在的资源链接，Active Record 将抛出 ActiveRecord::RecordNotFound 异常，Rails 默认异常处理为所有异常显示 500 服务器错误消息 。</p><p>如果请求是在本地发出的，那么会显示一个很好的回溯和一些添加的信息，这样您就可以找出问题所在并加以处理，如果请求是远程的，Rails 将只向用户显示一条简单的 <strong>“500 服务器错误”</strong> 消息，如果存在路由错误或找不到记录，Rails将显示一条 <strong>“404NotFound”</strong> 。有时您可能需要自定义如何捕获这些错误以及如何向用户显示这些错误，Rails 应用程序中有几种级别的异常处理 ：</p><h3 id="默认的-500、404-模板" tabindex="-1">默认的 500、404 模板 <a class="header-anchor" href="#默认的-500、404-模板" aria-label="Permalink to &quot;默认的 500、404 模板&quot;">​</a></h3><p>默认情况下，在生产环境中，应用程序错误将呈现 404 或 500 错误消息 。在开发环境中，所有未处理的异常都被简单地引发，这些消息将包含在404 和 500 公用文件夹中的静态 HTML 文件中，您可以自定义这些文件以添加一些额外的信息和样式，但请记住它们是静态 HTML ，你不能使用 erb、scss、CoffeeScript 或布局 。</p><h3 id="rescue-from" tabindex="-1">rescue_from <a class="header-anchor" href="#rescue-from" aria-label="Permalink to &quot;rescue_from&quot;">​</a></h3><p>如果你想在系统捕获到错误的时候去做一些事情，可以使用 rescue_from 注册属性，它将处理当前的控制器以及子类控制器中<strong>特定类型或多个类型的异常</strong>，当 rescue_from 属性指令捕获到异常时，异常对象被传递给处理程序，处理程序可以是传递给 :with 选项的方法，也可以直接使用块 。</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 下面介绍了如何使用 rescue_from 注册错误处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ActionController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Base</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 当监听到 ActiveRecord::RecordNotFound(当前没有发现这个路由) 错误，</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 就会调用 with 后面的选项方法 record_not_found 了.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  rescue_from </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ActiveRecord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RecordNotFound</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">with:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :record_not_found</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> record_not_found</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plain:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;404 Not Found&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">status:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 404</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ==============&gt; Rails 官方的建议-没有太多的位置-我就直接写这里了 &lt;============</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1、使用 Exception 或 StandardError 会导致严重的副作用，因为它会阻止 Rails 默认</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    正确的处理异常的机制，因此除非有充分理由，否则不建议这样做。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2、在生产环境中运行时，所有 ActiveRecord::RecordNotFound 错误都会呈现 404 错误</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    页面，除非您需要自定义行为，否则不需要处理此问题。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3、某些异常只能从 ApplicationController 类中重新搜索，因为它们是在控制器初始化和</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    操作执行之前引发的。</span></span></code></pre></div><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这边则是使用了块，做一个当错误发生时，邮件通知的一个需求</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ActionController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Base</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 1.Exception 是所有错误的基类，所以当项目中的所有错误都会被监听到</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	rescue_from </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |exception|</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# 2.当前项目是否是正式环境下，如果是则发送邮件，写 logger 日志</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Rails</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">production?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> or</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Rails</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">staging?</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">				# 3.写日志</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">				Rails</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">logger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Send excepiton email !&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">				# 4.发邮件</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">				SystemMailer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">web_exception_notify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AppConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">app_notify_receiver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						request:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						params:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> params,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						current_user:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current_user,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						exception:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exception</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deliver_now</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">				# 5.返回状态码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				redirect_to </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/?response_code=505&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		else</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 2.如果不是正式环境，直接抛出抛出错误就可以了，没有必要去发邮件，写日志</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			raise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exception</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><p>rescue_from 是可以监听到子类的错误的，所以我们在 ApplicationController 里面也可以监听到 ClientsController 里的错误，下面的案例是当客户端发起请求的时候，先确实用户身份。</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ActionController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Base</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 4.ClientsController 继承 ApplicationController 所以 rescue_from 能监听到 User::NotAuthorized 错误，并触发 user_not_authorized 方法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  rescue_from </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NotAuthorized</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">with:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :user_not_authorized</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 5.告诉客户端错误消息 You don&#39;t have access to this section. ，并返回 redirect_back 重定向页面</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> user_not_authorized</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      flash[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;You don&#39;t have access to this section.&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      redirect_back</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">fallback_location:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> root_path)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ClientsController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 2.当客户端发起请求，首先提前触发 check_authorization 方法，判断当前用户是否认证了.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  before_action </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:check_authorization</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 1.用户访问 edit 这个 active 接口方法，但前提是需要经过 2 这个步骤判定用户是否认证了，才可以访问这个接口</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> edit</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 3.判断当前 current_user.admin? 是否认证，如果返回 false 则抛出 User::NotAuthorized 错误</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> check_authorization</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NotAuthorized</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> unless</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current_user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">admin?</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h2 id="request-and-response-objects" tabindex="-1">Request and Response Objects <a class="header-anchor" href="#request-and-response-objects" aria-label="Permalink to &quot;Request and Response Objects&quot;">​</a></h2><p>每个控制器中都有两个访问器方法 request and response，它们指向当前正在执行的请求和响应对象，request 方法包含 ActionDispatch::request 的一个实例，response 方法返回一个响应对象，该对象表示将要发送回客户端的内容 。</p><h3 id="request-object-请求对象" tabindex="-1">request object 请求对象 <a class="header-anchor" href="#request-object-请求对象" aria-label="Permalink to &quot;request object 请求对象&quot;">​</a></h3><p>request 对象包含许多关于来自客户端的请求的有用信息，可以在此对象上访问的属性包括 ：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>**属性                                                  输出           详情描述</span></span>
<span class="line"><span>---------------------------------------------------------------------------------------------------------------------------------**</span></span>
<span class="line"><span>request.host                                                         返回用于此请求的主机名</span></span>
<span class="line"><span>request.domain(n=2)	                                                 返回 DNS 域名</span></span>
<span class="line"><span>request.format	                                                     客户端请求的内容类型</span></span>
<span class="line"><span>request.method	                                                     客户端请求的方法类型 [get,post....]</span></span>
<span class="line"><span>request.get?, post?, patch?, put?, delete?, head?	                   如果 HTTP 方法是 GET/POST/PATCH/PUT/DELETE/HEAD，则返回 true</span></span>
<span class="line"><span>request.headers	                                                     返回一个哈希，包含与请求关联的表头 header</span></span>
<span class="line"><span>request.port	                                        #=&gt; 3000       返回请求的端口号</span></span>
<span class="line"><span>request.protocol	                                    #=&gt; &quot;http://&quot;  返回包含所用协议的字符串加 &quot;://&quot;，例如 &quot;http://&quot;</span></span>
<span class="line"><span>request.query_string	                                               返回 URL 的查询字符串部分，即 ? 之后的所有内容</span></span>
<span class="line"><span>request.remote_ip	                                                   返回客户端的 IP 地址</span></span>
<span class="line"><span>request.url                                                          返回请求的整个 URL</span></span>
<span class="line"><span>request.fullpath                                                     HTTP请求路径</span></span>
<span class="line"><span>request.ip                                                           当前浏览器端用户端的 IP</span></span>
<span class="line"><span>request.body                                                         当前的请求 body</span></span></code></pre></div><aside> ✅ Rails 在 params 散列中收集与请求一起发送的所有参数，无论它们是作为查询字符串的一部分还是作为 post 正文发送的，请求对象有三个访问器（query_parameters，request_parameters，path_parameters），parameters 为访问请求的哈希参数，例 ：- request_url </aside><h3 id="response-object-响应对象" tabindex="-1">response object 响应对象 <a class="header-anchor" href="#response-object-响应对象" aria-label="Permalink to &quot;response object 响应对象&quot;">​</a></h3><p>响应对象通常不直接使用，而是在执行操作和发送回用户数据的过程中建立起来的，直接访问响应 response 会很有用，其中一些访问器方法还具有 setter，允许你更改其值 。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>**属性                  输出             详情描述</span></span>
<span class="line"><span>---------------------------------------------------------------------------------------------------------------------------------**</span></span>
<span class="line"><span>body                                  这是发送回客户端的数据字符串，这通常是 HTML</span></span>
<span class="line"><span>status                                响应的HTTP状态代码，如成功请求的HTTP状态代码为200，未找到文件的HTTP状态代码为404</span></span>
<span class="line"><span>location                              客户端被重定向到的URL（如果有）</span></span>
<span class="line"><span>content_type                          响应的内容类型</span></span>
<span class="line"><span>charset                               用于响应的字符集，默认值为 &quot;utf-8&quot;</span></span>
<span class="line"><span>headers                               用于响应的标题</span></span>
<span class="line"><span>response_code                         返回的状态码</span></span></code></pre></div><p>如果要为响应设置自定义 headers 配置，headers 属性是一个散列，它将名称映射到它们的值，Rails 将自动设置其中的一些值，如果你想添加或更改 headers ，只需将其分配给 response 即可，这样做：</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;application/pdf&quot;</span></span></code></pre></div><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 也可以 respond_to 这种方式返回一些 render</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UsersController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> index</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">all</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    respond_to </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |format|</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">html</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # index.html.erb</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xml</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">xml:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @users }</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @users }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h3 id="send-data-send-file" tabindex="-1">send_data / send_file <a class="header-anchor" href="#send-data-send-file" aria-label="Permalink to &quot;send_data / send_file&quot;">​</a></h3><p>send_data / send_file 方法就是允许我们向浏览器返回一个二进制的数据，一般是用在文件下载这类请求 。</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> download</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 返回服务器里的路径文件，并以二进制的形式返回给浏览器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	send_file </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/file/to/download.pdf&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> download</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# send_data 需要我们自己设置二进制文件返回给浏览器，type 是 header 中声明的文件类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	send_data image.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">content_type</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h2 id="rails-安全防范处理" tabindex="-1">Rails 安全防范处理 <a class="header-anchor" href="#rails-安全防范处理" aria-label="Permalink to &quot;Rails 安全防范处理&quot;">​</a></h2><h3 id="防止-csrf-攻击" tabindex="-1">防止 CSRF 攻击 <a class="header-anchor" href="#防止-csrf-攻击" aria-label="Permalink to &quot;防止 CSRF 攻击&quot;">​</a></h3><p>CSRF protect_from_forgery</p><h3 id="rails-logger-输出日志" tabindex="-1">Rails.logger 输出日志 <a class="header-anchor" href="#rails-logger-输出日志" aria-label="Permalink to &quot;Rails.logger 输出日志&quot;">​</a></h3><div class="language-jsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Rails.logger.info </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;debug.info&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Rails.logger.info </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Exception....&quot;</span></span></code></pre></div><h2 id="流媒体和文件下载" tabindex="-1">流媒体和文件下载 <a class="header-anchor" href="#流媒体和文件下载" aria-label="Permalink to &quot;流媒体和文件下载&quot;">​</a></h2><p>有时您可能希望向用户发送文件而不是呈现 HTML 页面，Rails 中的所有控制器都有 send_data 和 send_file 方法，它们都会将文件以数据流形式传输到客户端，send_file 是一种方便的方法，你只需要提供文件的路径，它会为您流式传输该文件的内容 。</p><h3 id="send-data-向客户端发送文件" tabindex="-1">send_data 向客户端发送文件 <a class="header-anchor" href="#send-data-向客户端发送文件" aria-label="Permalink to &quot;send_data 向客户端发送文件&quot;">​</a></h3><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ClientsController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> download_pdf</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">		client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">							# 可以是一个文件对象</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    send_data </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generate_pdf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client),         </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">							# 可以是一个文件路径，和上面参数只能使用一个，要么是文件对象，要么是路径</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">							&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Rails</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/files/clients/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.pdf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              # 文件的名称</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              filename:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.pdf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">							# 文件的类型 &#39;image/jpeg&#39; 、&#39;text/html; charset=utf-8&#39;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              type:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;application/pdf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                                    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">							# 流式传输文件时，客户端默认是下载形式的，如果你并不想客户端进行下载，而是想以附件的形式展现在客户端，你可以设置为 inline 内联形式.</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">							disposition:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;inline&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">							# 响应状态，有时候会显示项目下的 404 页面啥的，状态就是 404.</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">							status:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">							# 默认读取并流式以传输 4 kB 进行分段传输，避免一次将整个文件加载到内存中，如果你想关闭，可以使用这个配置</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						  stream:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              # 默认是 4kB ，如果你想自定义 stream 字节的大小，可以使用 buffer_size</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">							buffer_size： </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	private</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# Prawn 可以生成 PDF 文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate_pdf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      Prawn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> do</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        text client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">align:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :center</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        text </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Address: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        text </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Email: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">email</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">render</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h2 id="params-接受参数" tabindex="-1">Params 接受参数 <a class="header-anchor" href="#params-接受参数" aria-label="Permalink to &quot;Params 接受参数&quot;">​</a></h2><p>您可能希望访问用户发送的数据或控制器操作其他参数。在 Web 应用程序中有两种可能的参数。第一个是作为 URL 的一部分发送的参数，称为查询字符串参数。查询字符串是“？”之后的所有内容在网址中。第二种类型的参数通常称为 POST 数据。此信息通常来自用户填写的 HTML 表单。它被称为 POST 数据，因为它只能作为 HTTP POST 请求的一部分发送。Rails 不区分查询字符串参数和 POST 参数，两者都可以在 params 控制器的散列中使用：</p><h3 id="哈希参数与数组参数" tabindex="-1">哈希参数与数组参数 <a class="header-anchor" href="#哈希参数与数组参数" aria-label="Permalink to &quot;哈希参数与数组参数&quot;">​</a></h3><p>当 GET 请求是一个数组参数时，我们要将我们请求的数组路径拼接成右边这种形式 ，URL？表现形式如 /clients?ids[]=1&amp;ids[]=2&amp;ids[]=3 ，此示例中的实际 URL 将被编码为“/clients?ids%5b%5d=1&amp;ids%5b%5d=2&amp;ids%5b%5d=3”，因为 URL 中不允许使用“[”和“]”字符。大多数时候你不必担心这一点，因为浏览器会为你编码，Rails 会自动解码 。</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">params[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:ids</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>要发送哈希，请在括号内包含键名：</p><p>params [:client] 提交此表单时，的值为 { &quot;name&quot; =&gt; &quot;Acme&quot;, &quot;phone&quot; =&gt; &quot;12345&quot;, &quot;address&quot; =&gt; { &quot;postcode&quot; =&gt; &quot;12345&quot;, &quot;city&quot; =&gt; &quot;Carrot City&quot; } } 。请注意 params[:client][:address] 该 params 对象的作用类似于 Hash 。</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">form</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> accept-charset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UTF-8&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/clients&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;post&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;client[name]&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">              value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Acme&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;client[phone]&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;12345&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;client[address][postcode]&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;12345&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;client[address][city]&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Carrot City&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="路由参数-path" tabindex="-1">路由参数 Path <a class="header-anchor" href="#路由参数-path" aria-label="Permalink to &quot;路由参数 Path&quot;">​</a></h3><p>同时可以配置路径参数，只需在 config/router.rb 声明路由即可 ...</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># config/router.rb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># /clients/active</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">get </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/clients/:status&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">to:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;clients#index&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">foo:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;bar&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># params[:status]  =&gt; &quot;active&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># parmas[:foo]     =&gt; &quot;bar&quot;</span></span></code></pre></div><h3 id="强参数-parameters-permit" tabindex="-1">强参数 Parameters#permit <a class="header-anchor" href="#强参数-parameters-permit" aria-label="Permalink to &quot;强参数 Parameters#permit&quot;">​</a></h3><p>Params 其实是一个 ActionController::parameters 对象，它有两个方法分别是 ****require 、permit ，可以使用 require 验证 params 里面是否有某个指定的对象，如果没有就报 400 Bad Request error. 也可以使用 permit 设置字段白名单，过滤掉我们不需要的参数 。</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># request params { blog: {:id, :title, :author, :descript, :datatime, :commit} }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> BlogController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> update</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# 当创建一条数据的时候，程序员会上传一个表单，搞不好就会传递一些乱七八糟的参数，CURD 当操作表中没有的字段时则会报错</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 为了防止这种现象，我们可以使用 params.require.premit 声明参数白名单，过滤掉乱七八糟的参数，只返回我们规定字段</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 这样数据创建、更新时则更加安全.</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">		blog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Blog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		blog.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blog_params)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		redirect_to blog</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> blog_params</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # Params.require 参数对象必须要有 blog 对象，不然会报 400 Bad Request error.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			# Params.permit  声明参数白名单，虽然上面 params blog 对象里面有 6 个字段，但是仅仅只会保留白名单里面的字段 4 个</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			#                返回的也是一个 hash 对象 { :id, :title, :ahthor, :descript } </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			params.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:blog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">permit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:ahthor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:descript</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><aside> ⚠️ permit 白名单使用注意事项 ： 当字段过多时，声明过多的白名单是不方便的， 但想使用某个对象下的全部 Field 可以使用 permit(contact: {})，如果是数组可以这样声明 permit(contact: []), 也可以使用 permit! 将使用全部字段散列 params.require(:blog).permit! </aside><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 你还可以进行嵌套使用，permit 可以单独使用</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ActionController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Parameters</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  person:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Francesco&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    age:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  22</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    pets:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Purplish&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      category:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;dogs&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">permitted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = params.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">permit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">person:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pets:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } ])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">permitted.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">permitted?</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    # =&gt; true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">permitted[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:person</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># =&gt; &quot;Francesco&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">permitted[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:person</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:age</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># =&gt; nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">permitted[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:person</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:pets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># =&gt; &quot;Purplish&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">permitted[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:person</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:pets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:category</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># =&gt; nil</span></span></code></pre></div><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># permit 不容许指定一个对象，否则它还是返回一个空，你需要详细指定到字段</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ActionController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Parameters</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  person:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    contact:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      email:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;none@test.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      phone:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;555-1234&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">params.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:person</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">permit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:contact</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># =&gt; {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">params.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:person</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">permit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">contact:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :phone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># =&gt; {&quot;contact&quot;=&gt;{&quot;phone&quot;=&gt;&quot;555-1234&quot;}}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">params.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:person</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">permit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">contact:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:email</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:phone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># =&gt; { &quot;contact&quot;=&gt;{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#											&quot;email&quot;=&gt;&quot;none@test.com&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#											&quot;phone&quot;=&gt;&quot;555-1234&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#			}}</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"B1L5GfOu\",\"document_develop_app_index.md\":\"B7QC1L5I\",\"document_develop_app_优睡眠.md\":\"sZMFESbt\",\"document_develop_index.md\":\"CfQxI5DJ\",\"document_develop_seo.md\":\"DGfI0cMx\",\"document_develop_ui_index.md\":\"DwsB133P\",\"document_develop_ui_ux设计笔记.md\":\"uVN6TKKR\",\"document_develop_ui_设计资料笔记.md\":\"CvgTNhZ-\",\"document_develop_ui设计.md\":\"BEwtjumu\",\"document_develop_寻找远程开发工作.md\":\"CDhuxSyv\",\"document_develop_广告对接.md\":\"CkgKw7et\",\"document_develop_海外支付.md\":\"DaNRSN6-\",\"document_develop_独立开发应用部署.md\":\"CS8zgrVk\",\"document_develop_简历_index.md\":\"B_1TwJ_1\",\"document_develop_简历_在线简历.md\":\"B3Zpn04e\",\"document_develop_简历_项目截图.md\":\"CkOCY6ot\",\"document_develop_英语笔记_index.md\":\"QCduIdRs\",\"document_develop_英语笔记_语法1.md\":\"H4jB1pWQ\",\"document_english_index.md\":\"DfnmqBni\",\"document_english_语法.md\":\"CXVcdd0Z\",\"document_index.md\":\"BbIV0Y46\",\"document_services_golang_golang 基础编程.md\":\"Bwv0XwrY\",\"document_services_golang_index.md\":\"D3b_vsMz\",\"document_services_index.md\":\"vl5eeWVk\",\"document_services_linux_docker容器引擎.md\":\"L4ZBc83p\",\"document_services_linux_elasticsearch数据库操作.md\":\"Buyq5bam\",\"document_services_linux_git版本管理工具.md\":\"kmKn_-E5\",\"document_services_linux_index.md\":\"B0_bL-YA\",\"document_services_linux_linux基础命令.md\":\"CpdVq6cA\",\"document_services_linux_linux文本编辑工具.md\":\"CEWfedqW\",\"document_services_linux_linux系统配置文件.md\":\"Dt8u4Iny\",\"document_services_linux_linux运维常见场景操作.md\":\"B3WVrAUV\",\"document_services_linux_ngnix代理服务器.md\":\"DdsWd5it\",\"document_services_linux_redis数据库操作.md\":\"Dt0fGwfs\",\"document_services_linux_shell命令脚本.md\":\"B4FwqG11\",\"document_services_node_index.md\":\"4mIvrUjU\",\"document_services_node_nestjs_nestjs 安装与配置.md\":\"DBrgzFsR\",\"document_services_node_版本管理工具.md\":\"CqTjBMxe\",\"document_services_python_fastapi_fastapi 安装与配置.md\":\"CCZ05JRK\",\"document_services_python_index.md\":\"CfIcxIOL\",\"document_services_python_版本管理工具.md\":\"MQMEDalj\",\"document_services_python_语法基础.md\":\"DNPbbIg3\",\"document_services_ruby_index.md\":\"BFXKHT8F\",\"document_services_ruby_rails_rails cache 缓存.md\":\"DM5IqiEu\",\"document_services_ruby_rails_rails controller 控制器.md\":\"CeSCm7kl\",\"document_services_ruby_rails_rails mailer 发送邮件.md\":\"BD8HoMcT\",\"document_services_ruby_rails_rails model 数据模型层.md\":\"C1ExCibI\",\"document_services_ruby_rails_rails routing 路由器.md\":\"dPP6Gg2F\",\"document_services_ruby_rails_rails session、cookie、token 凭证及数据闪存.md\":\"B251RHAS\",\"document_services_ruby_rails_rails setting 约定配置.md\":\"B9XJu4gb\",\"document_services_ruby_rails_rails view 视图层.md\":\"C-lc3gUi\",\"document_services_ruby_rails_rails 安装与配置.md\":\"BPc7mjPR\",\"document_services_ruby_rails_rails 集成 sidekiq 队列.md\":\"HtrC2MH4\",\"document_services_ruby_rails_rails 集成 whenever 定时任务.md\":\"gjxDqcYI\",\"document_services_ruby_ruby 基础.md\":\"DPjoHvc3\",\"document_services_ruby_安装.md\":\"BQoEZFJZ\",\"document_views_flutter_dart语言基础.md\":\"mbja4NAt\",\"document_views_flutter_index.md\":\"TG7BB6pB\",\"document_views_flutter_pubspec配置.md\":\"CuPD58Fn\",\"document_views_flutter_widget component 组件、控件.md\":\"DgTPzYxD\",\"document_views_flutter_安装.md\":\"B1Dctenx\",\"document_views_flutter_状态管理.md\":\"CU4dYiNy\",\"document_views_flutter_语法基础与常用组件.md\":\"BjY9GTsm\",\"document_views_flutter_路由管理.md\":\"BZ6-unIC\",\"document_views_index.md\":\"BHiLR3gR\",\"document_views_vue_index.md\":\"CmtmoTLz\",\"document_views_vue_vue报错总结归纳.md\":\"uMEx1NK-\",\"document_views_前端常用代码段.md\":\"fcbwuIXj\",\"document_workers_index.md\":\"CC_AxCx7\",\"document_workers_timehut_bebememo 服务管理.md\":\"Dzzqd9B_\",\"document_workers_timehut_index.md\":\"C3PiyjX2\",\"document_workers_timehut_小屋服务启动管理.md\":\"EWJiXvXW\",\"document_workers_timehut_接口文档.md\":\"LhiY75_C\",\"document_workers_timehut_数据库表.md\":\"D1rNSMae\",\"index.md\":\"RJKiVwld\",\"markdown-examples.md\":\"Dq35XwxW\",\"markdown.md\":\"biBRSRTr\",\"material_02f842eb-8e89-4910-a241-8af9d74085bf.md\":\"B1kGVjEu\",\"notes_2025-02-26_bundler audit ruby 漏洞检查工具.md\":\"DTCyTidV\",\"notes_2025-02-28_mac brew 命令.md\":\"Bj9rxOp9\",\"notes_202503031748.md\":\"DjfFiYWA\",\"notes_202503101424.md\":\"a8TlH8vG\",\"notes_20250325_09_51.md\":\"CsTiHiyY\",\"readme.md\":\"BRJukgAp\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"VitePress\",\"description\":\"bolg ...\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"Zouzhu's Wiki\",\"search\":{\"provider\":\"local\"},\"outline\":{\"label\":\"目录大纲\",\"level\":\"deep\"},\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"联系我\",\"link\":\"mailto:zouzhuqorg@gmail.com\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/zouzhu-code-89\"},{\"icon\":\"twitter\",\"link\":\"...\"}],\"blogs\":[{\"title\":\"Bundler-Audit Ruby 安全漏洞检查工具\",\"description\":\"Bundler-Audit 是一个用于 Ruby 项目的工具，主要用于对 Gemfile.lock 文件进行补丁级别的验证。它能够检查项目中使用的 gem 是否存在已知的安全漏洞，并提供相应的修复建议。Bundler-Audit 通过与 Ruby Advisory Database 进行对比，确保项目依赖的 gem 版本是安全的。\",\"time\":\"2025-02-26\",\"path\":\"notes/2025-02-26_Bundler Audit Ruby 漏洞检查工具\",\"category\":\"ruby\",\"tags\":[\"插件\",\"检查安全漏洞\",\"ruby\"]},{\"title\":\"mac brew 命令\",\"description\":\"brew 是 mac 的包管理工具\",\"time\":\"2025-02-28\",\"path\":\"notes/2025-02-28_mac brew 命令\",\"category\":\"shell\",\"tags\":[\"brew\",\"包管理工具\"]},{\"title\":\"Vim 常用快捷键\",\"description\":\"\",\"time\":\"2025-03-03\",\"path\":\"notes/202503031748\",\"category\":\"shell\",\"tags\":[\"vim\",\"文本工具\"]},{\"title\":\"Podfile、DSL 和 Ruby 语法\",\"description\":\"\",\"time\":\"2025-03-10\",\"path\":\"notes/202503101424\",\"category\":\"ruby\",\"tags\":[\"ruby\"]},{\"title\":\"“向量化模型”与”矢量数据库“ 去实现图片搜索\",\"description\":\"\",\"time\":\"2025-03-25 09:56\",\"path\":\"notes/20250325_09_51\",\"category\":\"图片搜索\",\"tags\":[\"向量化模型\",\"矢量数据库\",\"图片搜索 \"]}],\"categorys\":{\"ruby\":[{\"title\":\"Bundler-Audit Ruby 安全漏洞检查工具\",\"description\":\"Bundler-Audit 是一个用于 Ruby 项目的工具，主要用于对 Gemfile.lock 文件进行补丁级别的验证。它能够检查项目中使用的 gem 是否存在已知的安全漏洞，并提供相应的修复建议。Bundler-Audit 通过与 Ruby Advisory Database 进行对比，确保项目依赖的 gem 版本是安全的。\",\"time\":\"2025-02-26\",\"path\":\"notes/2025-02-26_Bundler Audit Ruby 漏洞检查工具\",\"category\":\"ruby\",\"tags\":[\"插件\",\"检查安全漏洞\",\"ruby\"]},{\"title\":\"Podfile、DSL 和 Ruby 语法\",\"description\":\"\",\"time\":\"2025-03-10\",\"path\":\"notes/202503101424\",\"category\":\"ruby\",\"tags\":[\"ruby\"]}],\"shell\":[{\"title\":\"mac brew 命令\",\"description\":\"brew 是 mac 的包管理工具\",\"time\":\"2025-02-28\",\"path\":\"notes/2025-02-28_mac brew 命令\",\"category\":\"shell\",\"tags\":[\"brew\",\"包管理工具\"]},{\"title\":\"Vim 常用快捷键\",\"description\":\"\",\"time\":\"2025-03-03\",\"path\":\"notes/202503031748\",\"category\":\"shell\",\"tags\":[\"vim\",\"文本工具\"]}],\"图片搜索\":[{\"title\":\"“向量化模型”与”矢量数据库“ 去实现图片搜索\",\"description\":\"\",\"time\":\"2025-03-25 09:56\",\"path\":\"notes/20250325_09_51\",\"category\":\"图片搜索\",\"tags\":[\"向量化模型\",\"矢量数据库\",\"图片搜索 \"]}]},\"tags\":{\"插件\":[{\"title\":\"Bundler-Audit Ruby 安全漏洞检查工具\",\"description\":\"Bundler-Audit 是一个用于 Ruby 项目的工具，主要用于对 Gemfile.lock 文件进行补丁级别的验证。它能够检查项目中使用的 gem 是否存在已知的安全漏洞，并提供相应的修复建议。Bundler-Audit 通过与 Ruby Advisory Database 进行对比，确保项目依赖的 gem 版本是安全的。\",\"time\":\"2025-02-26\",\"path\":\"notes/2025-02-26_Bundler Audit Ruby 漏洞检查工具\",\"category\":\"ruby\",\"tags\":[\"插件\",\"检查安全漏洞\",\"ruby\"]}],\"检查安全漏洞\":[{\"title\":\"Bundler-Audit Ruby 安全漏洞检查工具\",\"description\":\"Bundler-Audit 是一个用于 Ruby 项目的工具，主要用于对 Gemfile.lock 文件进行补丁级别的验证。它能够检查项目中使用的 gem 是否存在已知的安全漏洞，并提供相应的修复建议。Bundler-Audit 通过与 Ruby Advisory Database 进行对比，确保项目依赖的 gem 版本是安全的。\",\"time\":\"2025-02-26\",\"path\":\"notes/2025-02-26_Bundler Audit Ruby 漏洞检查工具\",\"category\":\"ruby\",\"tags\":[\"插件\",\"检查安全漏洞\",\"ruby\"]}],\"ruby\":[{\"title\":\"Bundler-Audit Ruby 安全漏洞检查工具\",\"description\":\"Bundler-Audit 是一个用于 Ruby 项目的工具，主要用于对 Gemfile.lock 文件进行补丁级别的验证。它能够检查项目中使用的 gem 是否存在已知的安全漏洞，并提供相应的修复建议。Bundler-Audit 通过与 Ruby Advisory Database 进行对比，确保项目依赖的 gem 版本是安全的。\",\"time\":\"2025-02-26\",\"path\":\"notes/2025-02-26_Bundler Audit Ruby 漏洞检查工具\",\"category\":\"ruby\",\"tags\":[\"插件\",\"检查安全漏洞\",\"ruby\"]},{\"title\":\"Podfile、DSL 和 Ruby 语法\",\"description\":\"\",\"time\":\"2025-03-10\",\"path\":\"notes/202503101424\",\"category\":\"ruby\",\"tags\":[\"ruby\"]}],\"brew\":[{\"title\":\"mac brew 命令\",\"description\":\"brew 是 mac 的包管理工具\",\"time\":\"2025-02-28\",\"path\":\"notes/2025-02-28_mac brew 命令\",\"category\":\"shell\",\"tags\":[\"brew\",\"包管理工具\"]}],\"包管理工具\":[{\"title\":\"mac brew 命令\",\"description\":\"brew 是 mac 的包管理工具\",\"time\":\"2025-02-28\",\"path\":\"notes/2025-02-28_mac brew 命令\",\"category\":\"shell\",\"tags\":[\"brew\",\"包管理工具\"]}],\"vim\":[{\"title\":\"Vim 常用快捷键\",\"description\":\"\",\"time\":\"2025-03-03\",\"path\":\"notes/202503031748\",\"category\":\"shell\",\"tags\":[\"vim\",\"文本工具\"]}],\"文本工具\":[{\"title\":\"Vim 常用快捷键\",\"description\":\"\",\"time\":\"2025-03-03\",\"path\":\"notes/202503031748\",\"category\":\"shell\",\"tags\":[\"vim\",\"文本工具\"]}],\"向量化模型\":[{\"title\":\"“向量化模型”与”矢量数据库“ 去实现图片搜索\",\"description\":\"\",\"time\":\"2025-03-25 09:56\",\"path\":\"notes/20250325_09_51\",\"category\":\"图片搜索\",\"tags\":[\"向量化模型\",\"矢量数据库\",\"图片搜索 \"]}],\"矢量数据库\":[{\"title\":\"“向量化模型”与”矢量数据库“ 去实现图片搜索\",\"description\":\"\",\"time\":\"2025-03-25 09:56\",\"path\":\"notes/20250325_09_51\",\"category\":\"图片搜索\",\"tags\":[\"向量化模型\",\"矢量数据库\",\"图片搜索 \"]}],\"图片搜索 \":[{\"title\":\"“向量化模型”与”矢量数据库“ 去实现图片搜索\",\"description\":\"\",\"time\":\"2025-03-25 09:56\",\"path\":\"notes/20250325_09_51\",\"category\":\"图片搜索\",\"tags\":[\"向量化模型\",\"矢量数据库\",\"图片搜索 \"]}]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>