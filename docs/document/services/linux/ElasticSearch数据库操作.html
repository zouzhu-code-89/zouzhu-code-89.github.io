<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VitePress</title>
    <meta name="description" content="bolg ...">
    <meta name="generator" content="VitePress v1.0.0-rc.44">
    <link rel="preload stylesheet" href="/assets/style.ByrRUgO2.css" as="style">
    
    <script type="module" src="/assets/app.Ifi8pNdp.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.BvhOzVXl.js">
    <link rel="modulepreload" href="/assets/chunks/theme.ClYFn78N.js">
    <link rel="modulepreload" href="/assets/document_services_linux_ElasticSearch数据库操作.md.HwiEK5qt.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div><div class="w-screen h-[0px]"><!----></div><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8291ffa></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8291ffa> Skip to content </a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-3efcd581><div class="wrapper" data-v-3efcd581><div class="container" data-v-3efcd581><div class="title" data-v-3efcd581><div class="VPNavBarTitle" data-v-3efcd581 data-v-0ad69264><a class="title" href="/" data-v-0ad69264><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-ab19afbb><!--]--><span data-v-0ad69264> </span><!--[--><!--]--></a></div></div><div class="content" data-v-3efcd581><div class="content-body" data-v-3efcd581><!--[--><!--]--><div class="VPNavBarSearch search" data-v-3efcd581><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-3efcd581 data-v-f732b5d0><span id="main-nav-aria-label" class="visually-hidden" data-v-f732b5d0>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="mailto:zouzhuqorg@gmail.com" target="_blank" rel="noreferrer" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>联系我</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-3efcd581 data-v-283b26e9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-283b26e9 data-v-7df97737 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-7df97737></span><span class="vpi-moon moon" data-v-7df97737></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-3efcd581 data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zouzhu-code-89" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-358b6670><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="..." aria-label="twitter" target="_blank" rel="noopener" data-v-e71e869c data-v-358b6670><span class="vpi-social-twitter" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-3efcd581 data-v-8e87c032 data-v-af5898d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-af5898d3><span class="vpi-more-horizontal icon" data-v-af5898d3></span></button><div class="menu" data-v-af5898d3><div class="VPMenu" data-v-af5898d3 data-v-e42ed9b3><!----><!--[--><!--[--><!----><div class="group" data-v-8e87c032><div class="item appearance" data-v-8e87c032><p class="label" data-v-8e87c032>Appearance</p><div class="appearance-action" data-v-8e87c032><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-8e87c032 data-v-7df97737 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-7df97737></span><span class="vpi-moon moon" data-v-7df97737></span><!--]--></span></span></button></div></div></div><div class="group" data-v-8e87c032><div class="item social-links" data-v-8e87c032><div class="VPSocialLinks social-links-list" data-v-8e87c032 data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zouzhu-code-89" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-358b6670><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="..." aria-label="twitter" target="_blank" rel="noopener" data-v-e71e869c data-v-358b6670><span class="vpi-social-twitter" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-3efcd581 data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-3efcd581><div class="divider-line" data-v-3efcd581></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-0b5c97a1><button data-v-0b5c97a1>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-cb998dce data-v-6b52fe58><div class="content" data-v-6b52fe58><div class="outline-marker" data-v-6b52fe58></div><div class="outline-title" role="heading" aria-level="2" data-v-6b52fe58>目录大纲</div><nav aria-labelledby="doc-outline-aria-label" data-v-6b52fe58><span class="visually-hidden" id="doc-outline-aria-label" data-v-6b52fe58> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-6b52fe58 data-v-53c99d69><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _document_services_linux_ElasticSearch%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C" data-v-e6f2a212><div><h3 id="参考文档" tabindex="-1">参考文档 💯 <a class="header-anchor" href="#参考文档" aria-label="Permalink to &quot;参考文档 :100:&quot;">​</a></h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html" target="_blank" rel="noreferrer">ES 入门文档 Quick start guide | Elasticsearch Guide [8.15] | Elastic</a></p><h2 id="安装并运行-elasticsearch8-x" tabindex="-1">安装并运行 Elasticsearch8.x <a class="header-anchor" href="#安装并运行-elasticsearch8-x" aria-label="Permalink to &quot;安装并运行 Elasticsearch8.x&quot;">​</a></h2><h3 id="windows安装java环境" tabindex="-1">windows安装Java环境 <a class="header-anchor" href="#windows安装java环境" aria-label="Permalink to &quot;windows安装Java环境&quot;">​</a></h3><p>Java 版本，Java9、10、12、13 均为短期版本，不建议使用，ES8.x 只支持 JDK17</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>1.JDK下载链接: https://www.oracle.com/cn/java/technologies/downloads/#jdk17-windows</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2.安装 java17 到目录 D:\biancheng_dev\java17</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3.创建环境变量 %JAVA_HOME% =&gt; D:\biancheng_dev\java17</span></span>
<span class="line"><span>  path 配置 %JAVA_HOME%\bin</span></span>
<span class="line"><span>  (注意: 当不同的应用程序需要不同的 Java JDK 版本，当发生版本冲突时，ES 支持使用 %ES_JAVA_HOME% 环境变量，</span></span>
<span class="line"><span>  当 %JAVA_HOME% 不符合 ES 运行的 Java 版本环境时，会自动使用 %ES_JAVA_HOME%)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>4.查看 Java JDK 版本</span></span>
<span class="line"><span>&gt; javac --version</span></span>
<span class="line"><span>javac 17.0.10</span></span></code></pre></div><h3 id="下载安装-elasticsearch-8-7-0" tabindex="-1">下载安装 Elasticsearch 8.7.0 <a class="header-anchor" href="#下载安装-elasticsearch-8-7-0" aria-label="Permalink to &quot;下载安装 Elasticsearch 8.7.0&quot;">​</a></h3><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>Elasticsearch 下载地址: </span></span>
<span class="line"><span>https://www.elastic.co/cn/downloads/past-releases#elasticsearch</span></span></code></pre></div><h2 id="es-基本概念" tabindex="-1">ES 基本概念 <a class="header-anchor" href="#es-基本概念" aria-label="Permalink to &quot;ES 基本概念&quot;">​</a></h2><p>Elastic 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elastic 实例。单个 Elastic 实例称为一个节点（node）。一组节点 Elastic Node 构成一个集群（cluster）, 下面的介绍则摘录自 <a href="https://blog.csdn.net/UbuntuTouch/article/details/99443042" target="_blank" rel="noreferrer">Elasticsearch 中的一些重要概念: cluster, node, index, document, shards 及 replica_elasticsearch的index和-CSDN博客</a></p><h3 id="node-角色介绍" tabindex="-1">Node 角色介绍 <a class="header-anchor" href="#node-角色介绍" aria-label="Permalink to &quot;Node 角色介绍&quot;">​</a></h3><p>Node 表示单个 Elasticsearch 实例，在大多数环境中，每个节点都在单独的盒子或虚拟机上运行，一个集群由一个或多个 node 组成，<em><strong>在测试的环境中，我可以把多个 node 运行在一个 server 上，在实际的部署中，大多数情况还是需要一个 server 上运行一个 node</strong></em>，根据 node 的作用，可以分为如下的几种：</p><ul><li><p><strong>master-eligible</strong>：可以作为主 node<br><mark>一旦成为主 node，它可以管理整个 cluster 集群的设置及变化：创建，更新，删除 index；添加或删除 node；为 node 分配 shard，应用的集群设置，其他与管理相关的人物等。</mark>master 节点角色通常不是非常占用资源，因此，一个主节点就足够整个集群，并且可以共同位于在较小集群中运行其他角色的节点上。如果这个主节点崩溃，集群将选择其他节点之一作为主节点，这样接力棒就会继续。 主节点不参与文档的 CRUD 操作，但主节点仍然知道文档的位置。</p></li><li><p><strong>data</strong>：数据 node<br><mark>数据节点是实际的索引、搜索、删除和其他与文档相关的操作发生的地方</mark>。这些节点托管索引文档。 一旦收到索引请求，它们就会通过调用 Lucene 段上的编写器来将文档保存到其索引中。 可以想象，它们在 CRUD 操作期间经常与磁盘通信，因此它们是磁盘 I/O 和内存密集型操作，在最新的 Elastic Stack 发布版中 (7.9 之后），当我们部署多层（multi-tier）部署时，将使用数据节点角色的特定变体，它们是 data_hot、data_cold、data_warm 和 data_frozen 角色。</p></li><li><p><strong>ingest</strong>: 数据接入（比如 pipepline)<br><mark>Elasticsearch 的主要目标是索引、搜索和分析，但通常需要在将文档存储到 Elasticsearch 之前对其进行修改或增强</mark>。以下是这种情况下最常见的情况：<br> 1.预处理日志字符串以提取有意义的数据<br> 2.使用 NLP 工具丰富文本字段的内容<br> 3.使用 ML 计算字段丰富内容<br> 4.在摄取期间添加数据修改或转换，例如：在地理定位中转换 IP；在摄入时添加 DateTime 字段；在摄入时构建自定义字段（通过脚本）<br><img src="/services/elasticsearch/01.png" alt="loading-ag-526"></p></li><li><p><strong>machine learning (Gold/Platinum License)：</strong><br><mark>顾名思义，机器学习节点执行 ML 算法并检测异常。 它是商业许可证的一部分，因此你必须购买 XPack 许可证才能启用机器学习功能。</mark>关于 Elastic Stack 的订阅，详细请参阅链接 订阅 | Elastic Stack 产品和支持 | Elastic。</p></li><li><p><strong>Transform node</strong>：<br> 严格地说， <mark>transform 节点角色是列表中的最新成员，它用于数据的汇总</mark>，此节点是执行 transform API 调用所必需的，这将创建（转换）基于现有索引进行透视的新索引。</p></li><li><p><strong>coordinating node</strong> 协调节点：<br> 严格来说，这个不是一个种类的节点。它甚至可以是上面的任何一种节点。顾名思义，协调节点负责端到端地处理客户端的请求。这种节点通常是接受客户端的 HTTP 请求的。当向 Elasticsearch 提出请求时，其中一个节点（协调节点）会接收该请求并戴上协调员的帽子。 在接受请求后，协调器请求集群中的其他节点处理请求。 它在收集和整理结果并将它们发送回客户端之前等待响应。 它本质上充当工作管理器，将传入的请求分发到适当的节点并响应客户端。<mark>针对大的集群而言，通常的部署时使用一些专用的节点来接受客户端的请求</mark>。这样的节点可以不配置上面的任何角色，也就是它既不是 master，也不是 data，也不是 ingest，也不是 machine learning。<br><img src="/services/elasticsearch/02.png" alt=""></p><p>协调节点是一个特殊的节点，作为集群的代理/传递思想，它的主要优点如下：<br> 1.它可以很容易地被 kill 掉或从集群中删除，而不会造成任何问题。它不是 master 服务器，因此不参与集群功能，也不包含数据，因此不会因故障而发生数据重定位/复制。<br> 2.它可以防止由于开发人员/用户的错误查询而导致集群不稳定。 有时用户执行的聚合过大（即，日期直方图的范围为若干年，间隔为 10 秒）。 在这里 Elasticsearch 节点可能会崩溃。 在其最新版本中，Elasticsearch 有一个称为断路器（circuit breaker）的结构来防止类似的问题，但总是有边界情况可能会导致使用脚本的不稳定。协调节点不是主节点，它的过载不会对集群稳定性造成任何问题。<br> 3.如果协调器或客户端节点嵌入到应用程序中，则数据的往返次数会减少，从而加快应用程序的速度。<br> 4.你可以添加它们以平衡搜索和聚合吞吐量，而不会在集群中产生更改和数据重定位。</p></li></ul><h3 id="node-配置角色与集群组合" tabindex="-1">Node 配置角色与集群组合 <a class="header-anchor" href="#node-配置角色与集群组合" aria-label="Permalink to &quot;Node 配置角色与集群组合&quot;">​</a></h3><p>一般来说，一个 node 可以具有上面的一种或几种功能。我们可以在命令行或者 Elasticsearch 的配置文件（elasticsearch.yml）来定义：</p><table><thead><tr><th>Node类型</th><th>配置参数</th><th>默认值</th></tr></thead><tbody><tr><td>master-eligible</td><td>node.master</td><td>true</td></tr><tr><td>data</td><td>node.data</td><td>true</td></tr><tr><td>ingest</td><td>node.ingest</td><td>true</td></tr><tr><td>machine learning</td><td>node.ml</td><td>true (除了OSS发布版）</td></tr></tbody></table><p>你也可以让一个 node 做专有的功能及角色，<u>如果上面 node 配置参数没有任何配置，那么我们可以认为这个 node 是作为一个 coordination node。在这种情况下，它可以接受外部的请求，并转发到相应的节点来处理。</u>针对 master node，有时我们需要设置 cluster.remote.connect: false，这样它不可以作为 CCS/CCR 用途。<br> 在实际的使用中，我们可以把请求发送给 data/ingest/coordination 节点，而不能发送给 master 节点。了解了四种 Elasticsearch 节点后，你可以很容易地理解为与 Elasticsearch 一起工作而设计的完美架构应该与此类似：<img src="/services/elasticsearch/03.png" alt=""></p><p><img src="/services/elasticsearch/04.png" alt=""></p><p>我们可以通过对 config/elasticsearch.yml 文件中配置来定义一个 node 在集群中的角色：<img src="/services/elasticsearch/05.png" alt=""></p><p>在有些情况中，我们可以通过设置 node.voting_only 为 true 从而使得一个 node 在 node.master 为真的情况下，只作为参加 voting 的功能，而不当选为 master node。这种情况为了避免脑裂情况发生。它通常可以使用一个 CPU 性能较低的 node 来担当。更多关于主节点是如何被选举出来的，请详细阅读文章 “Elasticsearch：理解 Master，Elections，Quorum 及 脑裂”。<br> 在一个集群中，我们可以使用如下的一个命令来获取当前可以进行 vote 的所有 master-eligible 节点：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /_cluster/state?filter_path=metadata.cluster_coordination.last_committed_config</span></span></code></pre></div><p>你可能获得类似如下列表的结果：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;cluster_coordination&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;last_committed_config&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;Xe6KFUYCTA6AWRpbw84qaQ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;OvD79L1lQme1hi06Ouiu7Q&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;e6KF9L1lQUYbw84CTAemQl&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>在整个 Elastic 的架构中，Data Node 和 Cluster 的关系表述如下：<img src="/services/elasticsearch/06.png" alt=""></p><p>上面的定义适用于 Elastic Stack 7.9 发布版以前。在 Elastic Stack 7.9 之后，有了新的改进。请详细阅读文章 “<a href="https://elasticstack.blog.csdn.net/article/details/110947372" title="Elasticsearch：Node roles 介绍 - 7.9 之后版本" target="_blank" rel="noreferrer">Elasticsearch：Node roles 介绍 - 7.9 之后版本</a>”</p><h3 id="document-文档" tabindex="-1">Document 文档 <a class="header-anchor" href="#document-文档" aria-label="Permalink to &quot;Document 文档&quot;">​</a></h3><p>Elasticsearch 是面向文档的，这意味着你索引或搜索的最小数据单元是文档。文档在 Elasticsearch 中有一些重要的属性：</p><ol><li><p>它是独立的。文档包含字段（名称）及其值。</p></li><li><p>它可以是分层的。可以将其视为文档中的文档。字段的值可以很简单，就像位置字段的值可以是字符串一样。它还可以包含其他字段和值。例如，位置字段可能包含城市和街道地址。</p></li><li><p>结构灵活。你的文档不依赖于预定义的架构。例如，并非所有事件都需要描述值，因此可以完全省略该字段。但它可能需要新的字段，例如位置的纬度和经度</p></li></ol><p>文档通常是数据的 JSON 表示形式。JSON over HTTP 是与 Elasticsearch 进行通信的最广泛使用的方式，它是我们在本书中使用的方法。例如，你的聚会网站中的事件可以在以下文档中表示：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Elasticsearch Denver&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;organizer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Lee&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;location&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Denver, Colorado, USA&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span></code></pre></div><p>很多人认为 document 相比较于关系数据库，它相应于其中每个 record。<img src="/services/elasticsearch/07.png" alt=""></p><p><img src="/services/elasticsearch/08.webp" alt=""></p><p>当文档被 Elasticsearch 索引时，它存储在 _source 字段中。 每个文档中还添加了以下附加系统字段：</p><ul><li>存储文档的索引名称由 _index 字段指示。</li><li>文档的索引范围的唯一标识符存储在 _id 字段中。</li></ul><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;_index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;parties&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;_score&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;_source&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Elasticsearch Denver&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;organizer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Lee&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;location&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Denver, Colorado, USA&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span></code></pre></div><p>当我们通过 RESTFul API 与 Elasticsearch 通信时，我们将查询作为 JSON 对象发送到 Elasticsearch。反过来 Elasticsearch 会序列化这些 JSON 文档，并在分析后将它们存储在其分布式文档存储中。<br> 我们的数据（表示为 JSON 文档）在索引过程中由 Elasticsearch 解析。比如下面的图表示学生对象的 JSON 文档：</p><p><img src="/services/elasticsearch/09.png" alt=""></p><h3 id="sql-和-elasticsearch-的概念对比" tabindex="-1">SQL 和 Elasticsearch 的概念对比 <a class="header-anchor" href="#sql-和-elasticsearch-的概念对比" aria-label="Permalink to &quot;SQL 和 Elasticsearch 的概念对比&quot;">​</a></h3><p>针对大多数的数据开发者来说，他们更为熟悉的是 RMDB 里的概念。虽然 SQL 和 Elasticsearch 对数据的组织方式（以及不同的语义）有不同的术语，但本质上它们的目的是相同的。所以让我们从底部开始； 这些大致是：</p><h3 id="type-类型" tabindex="-1">Type 类型 <a class="header-anchor" href="#type-类型" aria-label="Permalink to &quot;Type 类型&quot;">​</a></h3><p>类型是文档的逻辑容器，类似于表是行的容器。 你将具有不同结构（模式）的文档放在不同类型中。 例如，你可以使用一种类型来定义聚合组，并在人们聚集时为事件定义另一种类型。</p><p>每种类型的字段定义称为映射。 例如，name 将映射为字符串，但 location 下的 geolocation 字段将映射为特殊的 geo_point 类型。 每种字段的处理方式都不同。 例如，你在名称字段中搜索单词，然后按位置搜索组以查找位于你居住地附近的组。</p><p>很多人认为 Elasticsearch 是 schema-less 的。大家都甚至认为 Elasticsearch 中的数据库是不需要 mapping 的。其实这是一个错误的概念。schema-less 在 Elasticsearch 中正确的理解是，我们不需要事先定义一个类型关系数据库中的 table 才使用数据库。在 Elasticsearch 中，我们可以不开始定义一个 mapping，而直接写入到我们指定的 index 中。这个 index 的 mapping 是动态生成的 （当然我们也可以禁止这种行为）。其中的数据项的每一个数据类型是动态识别的。比如时间，字符串等，虽然有些的数据类型还是需要我们手动调整，比如 geo_point 等地理位置数据。另外，它还有一个含义，同一个 type，我们在以后的数据输入中，可能增加新的数据项，从而生产新的 mapping。这个也是动态调整的。</p><p>Elasticsearch 具有 schema-less 的能力，这意味着无需显式指定如何处理文档中可能出现的每个不同字段即可对文档建立索引。 启用动态映射后，Elasticsearch 自动检测并向索引添加新字段。 这种默认行为使索引和浏览数据变得容易-只需开始建立索引文档，Elasticsearch 就会检测布尔值，浮点数和整数值，日期和字符串并将其映射到适当的 Elasticsearch 数据类型。</p><p>由于一些原因，在 Elasticsearch 6.0 以后，一个 Index 只能含有一个 type。这其中的原因是：相同 index 的不同映射 type 中具有相同名称的字段是相同； 在 Elasticsearch 索引中，不同映射 type 中具有相同名称的字段在 Lucene 中被同一个字段支持。在默认的情况下是 _doc。在未来 8.0 的版本中，type 将被彻底删除。更多信息，请阅读“<a href="https://elasticstack.blog.csdn.net/article/details/132553611" title="Elasticsearch:为什么从 Elasticsearch 7.0.0 及更高版本中删除了映射类型 type？" target="_blank" rel="noreferrer">Elasticsearch:为什么从 Elasticsearch 7.0.0 及更高版本中删除了映射类型 type？</a>”。</p><h3 id="index-索引" tabindex="-1">Index 索引 <a class="header-anchor" href="#index-索引" aria-label="Permalink to &quot;Index 索引&quot;">​</a></h3><p>在 Elasticsearch 中，索引是文档的集合。<img title="" src="/services/elasticsearch/10.png" alt="" width="686"></p><img title="" src="/services/elasticsearch/11.png" alt="" width="677"><img title="" src="/services/elasticsearch/12.webp" alt="" width="726"><p>Elasticsearch 起源于 Apache Lucene 。一个 Elasticsearch 的 index 分布于一个或多个 shard 之中，而每个 shard 相应于一个 Aache Lucene 的 index。每个 Index 一个或许多的 documents 组成，并且这些 document 可以分布于不同的 shard 之中。<img src="/services/elasticsearch/13.png" alt=""> 这是如何运作的？ Elasticsearch 将索引分成单独的块，称为分片。 此操作在索引级别进行，因为我们在每个索引中可能有不同数量的文档。 分片的优点如下：</p><ul><li>我们可以存档更多文件</li><li>它允许在节点中存放大的索引</li><li>由于索引上的查询并行化，它提供了更好的性能</li></ul><p><img src="/services/elasticsearch/14.png" alt=""></p><p><img src="/services/elasticsearch/15.png" alt=""></p><p>很多人认为 index 类似于关系数据库中的 database。这中说法是有些道理，但是并不完全相同。其中很重要的一个原因是，在Elasticsearch 中的文档可以有 object 及 nested 结构。一个 index 是一个逻辑命名空间，它映射到一个或多个主分片，并且可以具有零个或多个副本分片。<br> 每当一个文档进来后，根据文档的 id 会自动进行 hash 计算，并存放于计算出来的 shard 实例中，这样的结果可以使得所有的 shard 都比较有均衡的存储，而不至于有的 shard 很忙。</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">shard_num </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hash(_routing) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num_primary_shards</span></span></code></pre></div><p>在默认的情况下，上面的 _routing 既是文档的 _id。如果有 routing 的参与，那么这些文档可能只存放于一个特定的 shard，这样的好处是对于一些情况，我们可以很快地综合我们所需要的结果而不需要跨 node 去得到请求。比如针对 join 的数据类型。关于 routing 的更多知识，请参阅文章 “Elasticsearch：路由 - routing”。<br> 从上面的公式我们也可以看出来，我们的 shard 数目是不可以动态修改的，否则之后也找不到相应的 shard 号码了。必须指出的是，replica 的数目是可以动态修改的。</p><h3 id="shard-分片" tabindex="-1">Shard 分片 <a class="header-anchor" href="#shard-分片" aria-label="Permalink to &quot;Shard 分片&quot;">​</a></h3><p>Shard 也被称作为分片。由于 Elasticsearch 是一个分布式搜索引擎，因此索引通常会拆分为分布在多个节点上的称为分片的元素。 Elasticsearch 自动管理这些分片的排列。 它还根据需要重新平衡分片，因此用户无需担心细节。<br> 分片是保存数据、创建支持的数据结构（如倒排索引）、管理查询和分析 Elasticsearch 中的数据的软件组件。 它们是 Apache Lucene 的实例，在索引创建期间分配给索引。 在建立索引的过程中，文档会经过分片。 Shards 创建不可变文件段以将文档保存到持久文件系统中。Lucene 是一种用于高效索引文档的高性能引擎。 在为文档编制索引时，很多事情都在幕后进行，而 Lucene 高效地完成了这项工作。 例如，文档最初被复制到分片上的内存缓冲区中，然后在合并和最终确定它们到底层文件系统存储之前写入可写段。 该图演示了 Lucene 引擎在索引期间的内部工作：<img src="/services/elasticsearch/17.png" alt=""></p><p>一个索引可以存储超出单个结点硬件限制的大量数据。比如，一个具有 10 亿文档的索引占据 1 TB 的磁盘空间，而任一节点都没有这样大的磁盘空间；或者单个节点处理搜索请求，响应太慢。<br> 为了解决这个问题，Elasticsearch 提供了将索引划分成多份的能力，这些份就叫做分片（shard）。当你创建一个索引的时候，你可以指定你想要的分片（shard）的数量。每个分片本身也是一个功能完善并且独立的索引，这个索引可以被放置到集群中的任何节点上。 分片之所以重要，主要有两方面的原因：</p><ul><li><p>允许你水平分割/扩展你的内容容量</p></li><li><p>允许你在分片（潜在地，位于多个节点上）之上进行分布式的、并行的操作，进而提高性能/吞吐量</p></li></ul><p>有两种类型的分片：primary shard 和 replica shard。</p><ul><li><p>Primary shard: 每个文档都存储在一个 primary shard。 索引文档时，它首先在 primary shard上编制索引，然后在此分片的所有副本上（replica）编制索引。索引可以包含一个或多个主分片。 此数字确定索引相对于索引数据大小的可伸缩性。 创建索引后，无法更改索引中的主分片数。Primary 可以同时出来读和写操作。一个索引可以由多个主分片组成，每个分片都具有索引（或写入）文档的能力。 当 Elasticsearch 试图在集群中均匀分布分片时，每个主分片都可以利用节点资源来实现写入可扩展性。。当一个文档被索引到 Elasticsearch 中时，它会在被复制到副本分片之前由主分片索引。 只有在成功更新副本分片后才会确认索引请求，从而确保跨 Elasticsearch 集群的读取一致性。</p></li><li><p>Replica shard: 每个主分片可以具有零个或多个副本。 replica 是主分片的副本。replica 只能是只读的，不可以进行写入操作。replica 分片可以独立于主分片响应搜索（或读取）请求。 由于主分片和副本分片被分配到不同的节点（为索引提供更多计算资源），因此可以通过添加 replica 来实现读取可扩展性。如果一个索引的 primary shard 一旦被丢失（有宕机或者网络连接问题），那么相应的 replica shard 会被自动提升为新的 primary shard，进而新的 replica 也会在不同的 node 上生成。replica 有两个目的：</p><ul><li><p>增加故障转移：如果主要故障，可以将副本分片提升为主分片。即使你失去了一个 node，那么副本分片还是拥有所有的数据</p></li><li><p>提高性能：get 和 search 请求可以由主 shard 或副本 shard 处理。</p></li></ul></li></ul><p>我们需要记住的一点是：Primary 及 replica shards 一直是分配在不同的 node 上的，这样既提供了冗余度，也同时提供了可扩展行。<br> 默认情况下，每个主分片都有一个副本，但可以在现有索引上动态更改副本数。我们可以通过如下的方法来动态修改副本数：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PUT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my_index/_settings</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;number_of_replicas&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>永远不会在与其主分片相同的节点上启动副本分片。在最新的 Elasticsearch 集群设计中，我们可以使用 auto_expand_replica 这个配置来让 Elasticsearch 自动决定有多少个 replica。当我们有一个节点时，通过这个设置，我们可能会得到 0 个 replica 从而保证整个集群的健康状态。<br> 通常一个 shard 可以存储许多文档。在实际的使用中，增加副本 shard 的数量，可以提高搜索的速度，这是因为更多的 shard 可以帮我们进行同时进行搜索。但是副本 shard 数量的增多，也会影响数据写入的速度。在很多的情况下，在大批量数据写入的时候，我们甚至可以把 replica 的数量设置为 0。详细阅读可以参考文章 “Elasticsearch：如何提高 Elasticsearch 数据摄入速度”。增加 primary shard 的数量可以提高数据的写入速度，这是因为有更多的 shard 可以帮我们同时写入数据。可能有很多的开发者认为是不是 shard 的数量越多越好啊？oversharding 是 Elasticsearch 用户经常会遇到的一个问题。许多小的 shard 会消耗很多的资源，这是因为每一个 shard 其实对应的是一个 Lucene 的 index。一个 shard 通常可以存储几十个 G 的数据。如果你需要更多的 shard，你可以：</p><ul><li><p>创建更多的索引从而使得它容易扩展，比如针对一些时序数据，我们可以为它们每天或者每个星期创建新的索引</p></li><li><p>使用 Split API 来时一个大的索引增加 shard 的数量。我们可以阅读文章 “Elasticsearch：Split index API - 把一个大的索引分拆成更多分片”。</p></li></ul><p>一个 shard 的性能会随着它的大小而改变：<img src="/services/elasticsearch/18.png" alt=""></p><p>如上图所示，我们建议 50G 为索引的大小以求得最好的性能。在我们实际的 Beats 的使用中，默认的 ILM 索引大小就是 50G。为了最大限度地提高索引/搜索性能，分片应尽可能均匀分布在节点之间，以利用底层节点资源。 每个分片应保存 30GB 到 50GB 的数据，具体取决于数据类型及其使用方式。 例如，高性能搜索用例可以受益于整体较小的分片以运行快速搜索和聚合请求，而日志记录用例可能适合稍大的分片以在集群中存储更多数据。 可以根据你的性能要求、硬件和用例根据需要调整分片大小和每个节点的分片数量。你可以更进一步阅读文章 “<a href="https://elasticstack.blog.csdn.net/article/details/125715198" title="Elasticsearch：我的 Elasticsearch 集群中应该有多少个分片？" target="_blank" rel="noreferrer">Elasticsearch：我的 Elasticsearch 集群中应该有多少个分片？</a>” 以了解更多关于 shard 分配的知识。<br> 下面的图表示的是一个 index 有5个 primary shard 及 1 个 replica<img src="/services/elasticsearch/19.png" alt=""></p><p>这些 shard 分布于不同的物理机器上：<img src="/services/elasticsearch/20.png" alt=""></p><p>我们可以为每个 index 设置相应的 shard 数值：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -XPUT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:9200/another_user?pretty -H &#39;Content-Type: application/json&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;settings&quot; : {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;index.number_of_shards&quot; : 2,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;index.number_of_replicas&quot; : 1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    }</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&#39;</span></span></code></pre></div><p>比如在上面的 REST 接口中，我们为 another_user 这个 index 设置了2个 shards，并且有一个 replica。一旦设置好 primary shard 的数量，我们就不可以修改了。这是因为 Elasticsearch 会依据每个 document 的 id 及 primary shard 的数量来把相应的 document 分配到相应的 shard 中。如果这个数量以后修改的话，那么每次搜索的时候，可能会找不到相应的 shard。<br> 我们可以通过如下的接口来查看我们的 index 中的设置：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -XGET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:9200/twitter/_settings?pretty</span></span></code></pre></div><p>上面我们可以得到 twitter index 的设置信息：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;twitter&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;settings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;creation_date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1565618906830&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;number_of_shards&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;number_of_replicas&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;uuid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rwgT8ppWR3aiXKsMHaSx-w&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;created&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;7030099&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;provided_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;twitter&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="replica-副本" tabindex="-1">replica 副本 <a class="header-anchor" href="#replica-副本" aria-label="Permalink to &quot;replica 副本&quot;">​</a></h3><p>默认情况下，Elasticsearch 为每个索引创建一个主分片和一个副本。这意味着每个索引将包含一个主分片，每个分片将具有一个副本。<br> 分配多个分片和副本是分布式搜索功能设计的本质，提供高可用性和快速访问索引中的文档。主副本和副本分片之间的主要区别在于只有主分片可以接受索引请求。副本和主分片都可以提供查询请求。<br> 在上图中，我们有一个 Elasticsearch 集群，由默认分片配置中的两个节点组成。 Elasticsearch 自动排列分割在两个节点上的一个主分片。有一个副本分片对应于每个主分片，但这些副本分片的排列与主分片的排列完全不同。<br> 请允许我们澄清一下：请记住，number_of_shards 值与索引有关，而不是与整个群集有关。此值指定每个索引的分片数（不是群集中的主分片总数）。<br> 我们可以通过如下的接口来获得一个 index 的健康情况： (没写完，详情请看博客)</p><h3 id="sql-和-elasticsearch-的概念对比-1" tabindex="-1">SQL 和 Elasticsearch 的概念对比 <a class="header-anchor" href="#sql-和-elasticsearch-的概念对比-1" aria-label="Permalink to &quot;SQL 和 Elasticsearch 的概念对比&quot;">​</a></h3><p>针对大多数的数据开发者来说，他们更为熟悉的是 RMDB 里的概念。虽然 SQL 和 Elasticsearch 对数据的组织方式（以及不同的语义）有不同的术语，但本质上它们的目的是相同的。所以让我们从底部开始； 这些大致是：</p><p><img src="/services/elasticsearch/16.png" alt=""></p><p>正如人们所看到的，虽然概念之间的映射并不完全是一对一的，语义也有所不同，但共同点多于差异。 事实上由于 SQL 的声明性质，许多概念可以透明地在 Elasticsearch 中互换，并且这两个术语可能在以后教程的的一些部分中互换使用。</p><h2 id="elasticsearch-rest-api" tabindex="-1">Elasticsearch Rest API <a class="header-anchor" href="#elasticsearch-rest-api" aria-label="Permalink to &quot;Elasticsearch Rest API&quot;">​</a></h2><h3 id="get-cat-indices-v-查看当前节点的所有-index-信息" tabindex="-1">GET /_cat/indices?v 查看当前节点的所有 Index 信息 <a class="header-anchor" href="#get-cat-indices-v-查看当前节点的所有-index-信息" aria-label="Permalink to &quot;GET /_cat/indices?v 查看当前节点的所有 Index 信息&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ubuntu@beta-sz:~$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl http://127.0.0.1:9200/_cat/indices?v</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">health</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status index                uuid                   pri rep docs.count docs.deleted store.size pri.store.size</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">green</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  open   moment_production_10 jJTGAPYLTQWtjiVwolopDQ   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    5153426</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       755907</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      4.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gb          </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">green</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  open   moment_production_11 jVVom4FNQk-9XD6btiRtRQ   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1592330</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       101295</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      1.4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gb        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">735.6</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">green</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  open   moment_production_12 xPWLO-NHRGGrSgMNRIJ6NA   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    4657147</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       679298</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      4.6</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gb          </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">green</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  open   moment_production_13 I9zYyIuBSNq_Dc7x2lqO2A   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    6564312</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      1229938</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      6.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gb          </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">green</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  open   moment_production_14 Zblba2ZiQpWBpdrJMRNxCg   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    4455839</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       281059</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      3.9</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gb          </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.9</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">green</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  open   moment_production_15 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">m-i8DKLTAqvNCkn8-fy4Q   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    5490946</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       429450</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      4.9</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gb          </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gb</span></span></code></pre></div><h3 id="get-index-type-id-查询" tabindex="-1">GET /Index/Type/Id 查询 <a class="header-anchor" href="#get-index-type-id-查询" aria-label="Permalink to &quot;GET /Index/Type/Id 查询&quot;">​</a></h3><p>......</p><h3 id="get-index-name-count-查询索引文档数量" tabindex="-1">GET /index_name/_count 查询索引文档数量 <a class="header-anchor" href="#get-index-name-count-查询索引文档数量" aria-label="Permalink to &quot;GET /index_name/_count 查询索引文档数量&quot;">​</a></h3><ul><li><p>Elasticsearch 默认将一个索引分成多个分片（shards）来存储数据，以便提高查询和存储的性能。在这种情况下，<code>total</code> 表示索引的总分片数量 。</p></li><li><p>count 表示索引 <code>moment_production_10</code> 中的记录数量 。</p></li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">irb(main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">001&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.get </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/moment_production_10/_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {}, { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">headers:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> headers }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=&gt; [200, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{&quot;count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0, &quot;_shards&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{&quot;total&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5, &quot;successful&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5, &quot;skipped&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0, &quot;failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0}}]</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-b77f9094><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"document_develop_ui_index.md\":\"BFyxIcu-\",\"document_develop_app_优睡眠.md\":\"Dx72oqbN\",\"document_develop_app_index.md\":\"CskpiyOT\",\"api-examples.md\":\"CrOQkxQG\",\"document_develop_ui_ux设计笔记.md\":\"DUEzfdbU\",\"document_develop_ui_设计资料笔记.md\":\"BYuXLejH\",\"document_develop_index.md\":\"Cun5EPSP\",\"document_develop_ui设计.md\":\"CpazTB1i\",\"document_develop_广告对接.md\":\"xviImt--\",\"document_develop_寻找远程开发工作.md\":\"Cuvapj7a\",\"document_develop_简历_前端简历.md\":\"kV2fm0m7\",\"document_develop_简历_个人综合简历.md\":\"B5yHVmi4\",\"document_english_index.md\":\"BqhY9aBE\",\"document_develop_简历_index.md\":\"DebZ9dku\",\"readme.md\":\"CoXe71KJ\",\"document_english_语法.md\":\"fiIgIsgh\",\"document_develop_简历_服务器简历.md\":\"C1o5vdtN\",\"document_develop_海外支付.md\":\"D-LJ5cVF\",\"document_develop_seo.md\":\"DAs0LOTd\",\"document_services_index.md\":\"CC3dkkmD\",\"document_services_golang_index.md\":\"6M2sYYDD\",\"document_develop_独立开发应用部署.md\":\"C4P_5LdK\",\"document_index.md\":\"C2oiaVn8\",\"document_services_linux_docker容器引擎.md\":\"BBx8bpyk\",\"document_services_linux_git版本管理工具.md\":\"DDHOK9Gj\",\"document_services_linux_linux系统配置文件.md\":\"CeRa2h-b\",\"document_services_linux_linux文本编辑工具.md\":\"CfZjOf6I\",\"document_services_linux_linux基础命令.md\":\"DwpYCvgH\",\"document_services_linux_linux运维常见场景操作.md\":\"BbZimOBW\",\"document_services_linux_elasticsearch数据库操作.md\":\"HwiEK5qt\",\"document_services_golang_golang 基础编程.md\":\"BX_PXDQv\",\"document_services_linux_shell命令脚本.md\":\"X60qMVr0\",\"document_services_python_fastapi_fastapi 安装与配置.md\":\"DUCqvpW9\",\"document_services_node_版本管理工具.md\":\"DgSpCrap\",\"document_services_linux_index.md\":\"CxAvGICl\",\"document_services_node_index.md\":\"BGgDFnHV\",\"document_services_node_nestjs_nestjs 安装与配置.md\":\"qQWvF6ra\",\"document_services_python_index.md\":\"SXRgZekS\",\"document_services_python_多线程.md\":\"BEY-tHxE\",\"document_services_python_语法基础.md\":\"R3zLgl20\",\"document_services_linux_ngnix代理服务器.md\":\"D9M3npUn\",\"document_services_linux_redis数据库操作.md\":\"B8T9GQ_3\",\"document_services_ruby_index.md\":\"DBVHLTKL\",\"document_services_python_版本管理工具.md\":\"J5BpSd-s\",\"document_services_ruby_ruby 基础.md\":\"ClPly8Zb\",\"document_services_ruby_rails_rails cache 缓存.md\":\"CHW6BKZa\",\"document_services_ruby_rails_rails mailer 发送邮件.md\":\"BBrXg_kY\",\"document_services_ruby_rails_rails controller 控制器.md\":\"BDKalLSg\",\"document_services_ruby_rails_rails setting 约定配置.md\":\"CPpcxJZd\",\"document_services_ruby_rails_rails routing 路由器.md\":\"CDt_G8H8\",\"document_services_ruby_rails_rails 安装与配置.md\":\"BBHraqb7\",\"document_services_ruby_rails_rails 集成 sidekiq 队列.md\":\"DEa2VNes\",\"document_services_ruby_rails_rails view 视图层.md\":\"CDh7PiYY\",\"document_services_ruby_rails_rails session、cookie、token 凭证及数据闪存.md\":\"DjbojcvO\",\"document_services_ruby_rails_rails 集成 whenever 定时任务.md\":\"DBB07209\",\"document_views_flutter_pubspec配置.md\":\"CdCqUZ7Z\",\"document_services_ruby_安装.md\":\"BT3GwhdN\",\"document_views_flutter_index.md\":\"BjFwn1Wy\",\"document_views_flutter_dart语言基础.md\":\"CC5D5SI4\",\"document_views_flutter_状态管理.md\":\"I_FFIN_l\",\"document_views_flutter_安装.md\":\"DL07NOGY\",\"document_views_flutter_widget component 组件、控件.md\":\"Cto1oz-k\",\"document_views_vue_vue报错总结归纳.md\":\"cqf_H_7_\",\"document_workers_index.md\":\"28VGkZ6M\",\"document_views_flutter_路由管理.md\":\"Bfc0C4fn\",\"document_views_vue_index.md\":\"GqfPHiiy\",\"document_views_前端常用代码段.md\":\"CvNn839U\",\"document_views_index.md\":\"rF_bwDbo\",\"document_workers_timehut_index.md\":\"D3pfy4n0\",\"document_workers_timehut_bebememo 服务管理.md\":\"BJfWjFqf\",\"document_services_ruby_rails_rails model 数据模型层.md\":\"Brso_hfJ\",\"document_views_flutter_语法基础与常用组件.md\":\"Bb2Lo7vY\",\"document_workers_timehut_数据库表.md\":\"CTmLRCyy\",\"index.md\":\"DysIdLAj\",\"markdown.md\":\"BCGbwjPX\",\"document_workers_timehut_接口文档.md\":\"CyJ--iFo\",\"markdown-examples.md\":\"Dxo82RON\",\"document_workers_timehut_小屋服务启动管理.md\":\"Dzh2lmU1\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"VitePress\",\"description\":\"bolg ...\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.png\",\"siteTitle\":\" \",\"search\":{\"provider\":\"local\"},\"outline\":{\"label\":\"目录大纲\",\"level\":\"deep\"},\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"联系我\",\"link\":\"mailto:zouzhuqorg@gmail.com\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/zouzhu-code-89\"},{\"icon\":\"twitter\",\"link\":\"...\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>