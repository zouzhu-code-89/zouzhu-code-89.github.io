import{_ as s,c as i,o as a,a4 as n}from"./chunks/framework.Dc3ngIYm.js";const F=JSON.parse('{"title":"å°å±‹æœåŠ¡ç®¡ç†æ–‡æ¡£","description":"","frontmatter":{},"headers":[],"relativePath":"document/workers/timehut/ğŸ›– å°å±‹æœåŠ¡å¯åŠ¨ç®¡ç†.md","filePath":"document/workers/timehut/ğŸ›– å°å±‹æœåŠ¡å¯åŠ¨ç®¡ç†.md"}'),h={name:"document/workers/timehut/ğŸ›– å°å±‹æœåŠ¡å¯åŠ¨ç®¡ç†.md"},t=n(`<h1 id="å°å±‹æœåŠ¡ç®¡ç†æ–‡æ¡£" tabindex="-1">å°å±‹æœåŠ¡ç®¡ç†æ–‡æ¡£ <a class="header-anchor" href="#å°å±‹æœåŠ¡ç®¡ç†æ–‡æ¡£" aria-label="Permalink to &quot;å°å±‹æœåŠ¡ç®¡ç†æ–‡æ¡£&quot;">â€‹</a></h1><h2 id="rails-web-æœåŠ¡å¯åŠ¨" tabindex="-1">Rails Web æœåŠ¡å¯åŠ¨ <a class="header-anchor" href="#rails-web-æœåŠ¡å¯åŠ¨" aria-label="Permalink to &quot;Rails Web æœåŠ¡å¯åŠ¨&quot;">â€‹</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">puma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sidekiq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> å¯åŠ¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">å†·å¯åŠ¨ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service puma start </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> restart</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service sidekiq start </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> restart</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">æ™®é€šé‡å¯ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ./script/restart.sh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ./script/worker_daemon.sh</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sidekiq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> åå°åœ°å€ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    æ–°ç‰ˆï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        cn:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://beta.shiguangxiaowu.cn/sidekiq</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        hk:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://beta.peekaboomoments.com/sidekiq</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    æ—§ç‰ˆ(åé¢ä¼šåºŸå¼ƒ</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        cn:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://admin.shiguangxiaowu.cn/sidekiq</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        hk:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://admin.peekaboomoments.com/sidekiq</span></span></code></pre></div><h2 id="vip-ç›¸å…³æ“ä½œ" tabindex="-1">VIP ç›¸å…³æ“ä½œ <a class="header-anchor" href="#vip-ç›¸å…³æ“ä½œ" aria-label="Permalink to &quot;VIP ç›¸å…³æ“ä½œ&quot;">â€‹</a></h2><h3 id="éªŒè¯è®¢å•-payment" tabindex="-1">éªŒè¯è®¢å• Payment <a class="header-anchor" href="#éªŒè¯è®¢å•-payment" aria-label="Permalink to &quot;éªŒè¯è®¢å• Payment&quot;">â€‹</a></h3><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Payment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.find(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1590</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).verify_again</span></span></code></pre></div><h2 id="ç”¨æˆ·åé¦ˆæ“ä½œ" tabindex="-1">ç”¨æˆ·åé¦ˆæ“ä½œ <a class="header-anchor" href="#ç”¨æˆ·åé¦ˆæ“ä½œ" aria-label="Permalink to &quot;ç”¨æˆ·åé¦ˆæ“ä½œ&quot;">â€‹</a></h2><h3 id="ä¸ºç”¨æˆ·å¼€æ”¾æ¯æ—¥ä¸€æ‹" tabindex="-1">ä¸ºç”¨æˆ·å¼€æ”¾æ¯æ—¥ä¸€æ‹ <a class="header-anchor" href="#ä¸ºç”¨æˆ·å¼€æ”¾æ¯æ—¥ä¸€æ‹" aria-label="Permalink to &quot;ä¸ºç”¨æˆ·å¼€æ”¾æ¯æ—¥ä¸€æ‹&quot;">â€‹</a></h3><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BabyMomentTagAttr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.create! </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">baby_id:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 540498005</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">moment_tag_id:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 581913</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tag_desc:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tag_day_desc:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">comments_count:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">likes_count:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">usn:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 35858951</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">active:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tag_name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;æ¯æ—¥ä¸€æ‹&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">insurance:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">user_id:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">day:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span></span></code></pre></div><h3 id="æ¢å¤ç”¨æˆ·æ•°æ®é‡æ–°ç”Ÿæˆ-event" tabindex="-1">æ¢å¤ç”¨æˆ·æ•°æ®é‡æ–°ç”Ÿæˆ Event <a class="header-anchor" href="#æ¢å¤ç”¨æˆ·æ•°æ®é‡æ–°ç”Ÿæˆ-event" aria-label="Permalink to &quot;æ¢å¤ç”¨æˆ·æ•°æ®é‡æ–°ç”Ÿæˆ Event&quot;">â€‹</a></h3><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line highlighted"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1.ä¿®æ”¹å­©å­çš„æ—¶åŒº</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fix_time_zone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bid)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  baby </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Baby</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.find(bid)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  baby.secret_room </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    baby.moments.find_each </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |moment|</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      baby.from_age(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.zone.at(moment.taken_at_gmt)).tap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |m, d|</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        moment.total_days </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> moment.from_age_pair m, d</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      moment.save</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2.è¿˜è¦è°ƒ baby event rebuild é‡ç½®çŠ¶æ€</span></span></code></pre></div><h2 id="ç»Ÿè®¡æ•°æ®æ“ä½œ" tabindex="-1">ç»Ÿè®¡æ•°æ®æ“ä½œ <a class="header-anchor" href="#ç»Ÿè®¡æ•°æ®æ“ä½œ" aria-label="Permalink to &quot;ç»Ÿè®¡æ•°æ®æ“ä½œ&quot;">â€‹</a></h2><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ‹‰å–å°æ—¶æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RealtimeAutomator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.run</span></span></code></pre></div>`,13),e=[t];function l(k,p,d,r,g,y){return a(),i("div",null,e)}const E=s(h,[["render",l]]);export{F as __pageData,E as default};
