import{_ as i,c as a,o as n,a2 as t}from"./chunks/framework.DzQ5xTzt.js";const c=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"document/services/ruby/rails/Rails Setting çº¦å®šé…ç½®.md","filePath":"document/services/ruby/rails/Rails Setting çº¦å®šé…ç½®.md"}'),l={name:"document/services/ruby/rails/Rails Setting çº¦å®šé…ç½®.md"};function e(p,s,h,k,r,d){return n(),a("div",null,s[0]||(s[0]=[t(`<h2 id="rails-setting-çº¦å®šé…ç½®" tabindex="-1">Rails Setting çº¦å®šé…ç½® <a class="header-anchor" href="#rails-setting-çº¦å®šé…ç½®" aria-label="Permalink to &quot;Rails Setting çº¦å®šé…ç½®&quot;">â€‹</a></h2><p><a href="https://ruby-china.github.io/rails-guides/configuring.html#configuring-active-job" target="_blank" rel="noreferrer">é…ç½® Rails åº”ç”¨ â€” Ruby on Rails Guides</a></p><h2 id="çº¦å®šå·¥ç¨‹ç›®å½•ç»“æ„åŠåŠŸèƒ½" tabindex="-1">çº¦å®šå·¥ç¨‹ç›®å½•ç»“æ„åŠåŠŸèƒ½ <a class="header-anchor" href="#çº¦å®šå·¥ç¨‹ç›®å½•ç»“æ„åŠåŠŸèƒ½" aria-label="Permalink to &quot;çº¦å®šå·¥ç¨‹ç›®å½•ç»“æ„åŠåŠŸèƒ½&quot;">â€‹</a></h2><h3 id="concerns-é€šç”¨å…¬å…±é€»è¾‘ç›®å½•" tabindex="-1">c<strong>oncerns é€šç”¨å…¬å…±é€»è¾‘ç›®å½•</strong> <a class="header-anchor" href="#concerns-é€šç”¨å…¬å…±é€»è¾‘ç›®å½•" aria-label="Permalink to &quot;c**oncerns é€šç”¨å…¬å…±é€»è¾‘ç›®å½•**&quot;">â€‹</a></h3><p>åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ï¼ŒRails é»˜è®¤åœ¨ Controllerï¼ŒModels éƒ½å¸®æˆ‘ä»¬ç”Ÿæˆäº† Concerns è¿™ä¸ªç›®å½•ï¼ŒRails å¸Œæœ›æˆ‘ä»¬å°†ä¸€äº›é€šç”¨çš„åŠŸèƒ½æ–¹æ³•ï¼Œå°è£…æˆæ¨¡å—ç»Ÿä¸€ç®¡ç†ï¼Œéœ€è¦çš„æ—¶å€™ç›´æ¥è°ƒç”¨å³å¯ï¼Œä¾‹ä¸‹é¢çš„ç»“æ„åˆ™æ˜¯åšäº†ä¸€ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬å°† user_session åŠŸèƒ½å•ç‹¬å°è£…åœ¨ Concerns é‡Œé¢ ï¼š</p><ul><li>app â†’ æ‰€æœ‰çš„åŠŸèƒ½ä»£ç éƒ½åœ¨ App ç›®å½•é‡Œé¢ <ul><li>Controller â†’ æ§åˆ¶å±‚ <ul><li>concerns â†’ é€šç”¨çš„ä»£ç å°è£…çš„åœ°æ–¹ <ul><li>user_session.rb â†’ æˆ‘ä»¬è‡ªå·±å°è£…çš„æ¨¡å—</li></ul></li></ul></li></ul></li></ul><p>ç„¶åå¯ä»¥åœ¨ä»»æ„ Controller ä¸­å¯¼å…¥ include Concerns::UserSession è¿™ä¸ªæ¨¡å—ï¼Œè¿™æ ·å½“å‰çš„ Controller ä»¥åŠå­ç±»éƒ½å¯ä»¥ä½¿ç”¨ UserSession ä¸‹é¢çš„æ‰€æœ‰æ–¹æ³•äº†ï¼Œå› ä¸ºå£°æ˜äº† helper_method ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ view å±‚ä¸­ä½¿ç”¨ logged_in? | current_user è¿™ä¸¤ä¸ªæ–¹æ³•äº†ã€‚</p><aside> ğŸ’¡ include æ¨¡å—åå°±å¯ä»¥ä½¿ç”¨æ¨¡å—å†…çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¦‚æœæƒ³è¦åœ¨ view ä¸­ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å¿…é¡»å°†æˆ‘ä»¬æƒ³è¦åœ¨ view ä¸­ä½¿ç”¨çš„æ–¹æ³•å£°æ˜ä¸ºä¸€ä¸ª helper æ–¹æ³• ã€‚ </aside><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># app -&gt; controller -&gt; ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ActionController:Base</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	include</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Concerns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserSession</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SessionsController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> create</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		@user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find_by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">username:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> params[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:username</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">												 password:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> params[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @user</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			signin_user @user </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¦‚æœè´¦å·æ­£ç¡®ï¼Œå­ç±»ä¸­åˆ™ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¿å­˜ session</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">				status:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ok&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">				msg:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">redirect_url:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> root_path}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Rails éƒ½æ˜¯é‡‡ç”¨è·¯å¾„çº¦æŸæ¥è¯†åˆ«çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸ª Concerns ï¼Œç„¶åå°†ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ”¾åœ¨ Concerns é‡Œé¢ï¼Œä»¥å‘½åç©ºé—´çš„å½¢å¼.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Concerns</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# UserSession </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UserSession</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# =================&gt; self.included &lt;==================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# å¦‚æœ UserSession æ¨¡å—è¢« include åˆ°ç›®æ ‡ç±»çš„æ—¶å€™ï¼Œç›®æ ‡ç±»å°±ä¼šæ‰§è¡Œå½“å‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# çš„è¿™ä¸ªæ–¹æ³•ï¼Œåå‘çš„å°†è¿™ä¸¤ä¸ªæ–¹æ³•å£°æ˜ä¸º helper æ–¹æ³•.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> self.included</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			base.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">class_eval</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> do</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				helper_method </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:logged_in?</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				helper_method </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:current_user</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# 1.å½“ç”¨æˆ·ç™»é™†çš„æ—¶å€™ï¼Œå°±å°† User.id ä¿å­˜åˆ° session</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> signin_user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			session[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# 2.ç”¨æˆ·é€€å‡ºçš„æ—¶å€™ï¼Œå°† user_id æ¸…ç©º</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> logout_user</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			session[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# 3.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰ user_id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> logged_in</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			# è¿™é‡Œç¬¬ä¸€ä¸ªæ„Ÿå¹å·(é)çš„ä½œç”¨æ˜¯å–åï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			# ç¬¬äºŒä¸ªåˆ™æ˜¯å°†è¿”å›çš„ç»“æœè½¬ä¸ºå¸ƒå°”ç±»å‹ trueã€false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			!!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">session[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# 4.å¦‚æœæœ‰åˆ™èµ‹å€¼å¹¶è¿”å› @current_user å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å°±è¿”å› nil</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> current_user</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> logged_in?</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				@current_user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(session[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">				# @current_user = @current_user || User.find(session[:user_id])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			else</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">				nil</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div>`,11)]))}const E=i(l,[["render",e]]);export{c as __pageData,E as default};
